!function(){"use strict";angular.module("ARoutePermission",[]).run(["$rootScope","$location","$browser","ARoutePermission","ARoutePermissionExceptions","$arp_permissions","$arp_utils",function(e,t,r,n,o,i,s){function a(e){var t;"$stateChangeError"===e.name?t=arguments[5]||null:"$routeChangeError"===e.name&&(t=arguments[3]||null),t&&t.$$arp&&(console.log("[ARoutePermission]","error exception catched"),"function"==typeof e.preventDefault&&e.preventDefault(),"function"==typeof e.stopPropagation&&e.stopPropagation(),t.$$do())}function u(e){var t="";if("$routeChangeSuccess"==e.name)try{t=arguments[1].$$route.__url}catch(r){}else if("$stateChangeSuccess"==e.name)try{t=arguments[1].url}catch(r){}console.log("[ARoutePermission]","route successfully changed",t)}e.$on("$locationChangeStart",function(n,a,u,c,l){if(!n.defaultPrevented){var p=t.$$replace,f=s.getRouteByUrl(a);f&&f.permissions&&f.permissions.length>0&&(console.log("[ARoutePermission]","Validating permissions for the route",a),n.preventDefault(),i.run(f.permissions,function(n,i){n?(console.log("[ARoutePermission]","Permissions validated"),r.url(a,p),e.$evalAsync(function(){t.$$parse(a),e.$broadcast("$locationChangeSuccess",a,u)}),e.$$phase||e.$digest()):(i||(i=o.NotAllow()),i.$$do(f))}))}}),e.$on("$routeChangeError",a),e.$on("$stateChangeError",a),e.$on("$stateChangeSuccess",u),e.$on("$routeChangeSuccess",u)}])}(),function(){"use strict";function e(e,t){function r(){return e.apply(this,t)}return r.prototype=e.prototype,new r}angular.module("ARoutePermission").factory("ARoutePermissionExceptions",["ARoutePermission","$location",function(t,r){function n(){if(!(this.redirect=arguments[0]))throw'RedirectException require "path" as parameter';"boolean"==typeof arguments[1]?this.resolveFinalPath=Boolean(arguments[1]===!0):"string"==typeof arguments[1]&&(this.finalPath=arguments[1]),"string"==typeof arguments[2]&&(this.redirectParam=arguments[2])}function o(e){this.redirect_to_if_first_route=void 0!==e?e:!1}var i=function(){var e=arguments,t=this;return{$$arp:!0,$$do:function(){t.$$do.apply(t,e)}}},s={result:i,$$arp:!0};return n.prototype=angular.extend({},s,{name:"RedirectException",$$do:function(){this.resolveFinalPath&&(arguments[0]=r.absUrl()),this.finalPath&&(arguments[0]=this.finalPath),"object"==typeof arguments[0]&&(arguments[0]=arguments[0].__url||null),console.log("[ARoutePermission]","RedirectException [redirect:"+this.redirect+"] intent:",arguments[0]||null),t.$$redirectTo(this.redirect,arguments[0]||null,this.redirectParam?this.redirectParam:null)}}),o.prototype=angular.extend({},s,{name:"NotAllowException",$$do:function(){this.redirect_to_if_first_route&&t.$$is_first_route&&t.$$redirectTo(this.redirect_to_if_first_route)}}),{Redirect:function(){return e(n,arguments)},NotAllow:function(){return e(o,arguments)}}}])}(),function(){"use strict";angular.module("ARoutePermission").factory("$arp_utils",["$injector","$location","$browser",function(e,t,r){function n(e,t){return{permissions:e.permissions,__url:t}}var o=e.has("$route")?e.get("$route"):null,i=e.has("$state")?e.get("$state"):null,s=r.baseHref().replace(/\/$/,""),a={siteUrl:function(e){return/^https?\:\/\//.test(e)?e:location.origin+s+e},parseURL:function(e){var t=document.createElement("a");return t.href=e,t},getRouteByUrl:function(r){if(r){var s=t.absUrl().replace(/\?(.*)$/,"").replace(location.origin,"").replace(t.path(),""),a=r;if(a=a.replace(location.origin,""),a=a.replace(s,""),a=a.replace(/\?(.*)$/,""),/^https?/.test(a))return null;if(i){var u=e.get("$urlMatcherFactory"),c=i.get();for(var l in c){var p=u.compile(c[l].url);if(p.regexp&&a.match(p.regexp))return n(c[l],r)}}if(o)for(var l in o.routes)if(o.routes[l].regexp&&a.match(o.routes[l].regexp))return n(o.routes[l],r)}},location:{_normalize:function(e){return 0==e.indexOf(location.origin+s)?e.substr((location.origin+s).length):e},replace:function(e){e=this._normalize(e),/https\:\/\/?/.test(e)||"object"!=typeof a.getRouteByUrl(e)?window.location.replace(a.siteUrl(e)):t.replace().url(e)},path:function(e){e=this._normalize(e),/https\:\/\/?/.test(url)||"object"!=typeof this.getRouteByUrl(e)?window.location=a.siteUrl(e):t.path(e)}}};return a}]),window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""))}(),function(){"use strict";angular.module("ARoutePermission").factory("$arp_storage",function(){function e(t){return this instanceof e?void(this.prefix=t||"store"):new e(t)}return e.prototype.localStoreSupport=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},e.prototype.set=function(e,t,r){var n=this.prefix+"_"+e,o=null;if(r){var i=new Date;i.setTime(i.getTime()+60*r*1e3);var o=i}if(this.localStoreSupport())localStorage.setItem(n,JSON.stringify({expires:o?o.getTime():null,value:t}));else{var s=n+"="+JSON.stringify(t)+"; ";o&&(s+="expires="+o.toGMTString()+"; "),document.cookie=s+"path=/; "}},e.prototype.get=function(e){var t=this.prefix+"_"+e;if(this.localStoreSupport()){var r=localStorage.getItem(t);if(!r)return null;var n=JSON.parse(r);return n.expires&&(new Date).getTime()>n.expires?this.del(e):n.value}for(var o=t+"=",i=document.cookie.split(";"),s=0;s<i.length;s++){for(var a=i[s];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(o)){var r=a.substring(o.length,a.length);return r?JSON.parse(r):null}}return null},e.prototype.del=function(e){var t=this.prefix+"_"+e;return this.localStoreSupport()?localStorage.removeItem(t):this.set(t,"",-1),null},e("arp")})}(),function(){"use strict";angular.module("ARoutePermission").factory("$arp_permissions",function(){function e(e,t){if(!e||!e.length)return void t();var r=0,n=function(){r++,r==e.length&&t()};for(var o in e)e[o]()["finally"](function(){n()})}return{run:function(e,t){function r(){console.log("[ARoutePermission]","Running permission:",e[o]),n.test(e[o],function(e,n){o++,console.log("[ARoutePermission]","Permission status:",e,n||""),e?i>o?r():t(!0):t(!1,n)})}if(!e.length)return void t(!0);var n=this,o=0,i=e.length;r()},test:function(t,r){if(!(this.permissions[t]instanceof Object))throw"Permission '"+t+"' not registered";var t=this.permissions[t];e(t.resolvers,function(){var e=t.test();e===!0?r(!0):"object"==typeof e&&e.$$arp?r(!1,e):r(!1)})},add:function(e,t,r){if(this.permissions[e])throw"Permission '"+e+"' already added";this.permissions[e]={test:t,resolvers:r}},permissions:{}}})}(),function(){"use strict";angular.module("ARoutePermission").service("ARoutePermission",["$rootScope","$location","$arp_permissions","$arp_storage","$arp_utils","$browser",function(e,t,r,n,o,i){function s(){p&&p(),f&&f(),g&&g()}function a(){n.del(c)}function u(){function t(e){(arguments[1]&&"$stateChangeSuccess"===e.name&&r.currentPath!=arguments[1].url||"$routeChangeSuccess"===e.name&&arguments[1].$$route.originalPath!=r.currentPath)&&(s(),a())}var r=n.get(c);r&&(p=e.$on("$$arp__onRedirectResult",function(e,t){e.preventDefault(),p(),a(),l.$$redirectTo(t?r.requestedPath:"/")}),f=e.$on("$routeChangeSuccess",t),g=e.$on("$stateChangeSuccess",t))}var c="redirect",l=this,p=null,f=null,g=null;l.$$is_first_route=!0;var $=function(){l.$$is_first_route=!1,h&&h(),m&&m()},h=e.$on("$routeChangeSuccess",$),m=e.$on("$stateChangeSuccess",$);u(),this.completed=function(t,r){e.$broadcast("$$arp__onRedirectResult",t).defaultPrevented||"function"==typeof r&&r()},this.register=function(){return r.add.apply(r,arguments),this},this.$$redirectTo=function(e,t,r){s(),console.log("[ARoutePermission]","$$redirectTo",e,t,r),t&&!r?(n.set(c,{requestedPath:t,currentPath:e},15),u()):t&&(e.indexOf(r)&&(e=e.replace(new RegExp("[?|&]?"+r+"=([^&])*"),"")),e+=(-1!=e.indexOf("?")?"&":"?")+r+"="+t),o.location.replace(e)}}])}();